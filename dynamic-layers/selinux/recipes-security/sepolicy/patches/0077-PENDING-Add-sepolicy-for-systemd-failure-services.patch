From ab90448c2552d64ac78f7b1940a99a126811f7b4 Mon Sep 17 00:00:00 2001
From: jianbinz <quic_jianbinz@quicinc.com>
Date: Wed, 25 Sep 2024 14:54:17 +0530
Subject: [PATCH] PENDING: Add sepolicy for systemd failure services

Add sepolicy for systemd failure services

Upstream-Status: Pending

Signed-off-by: jianbinz <quic_jianbinz@quicinc.com>
---
 policy/modules/system/init.if    | 36 ++++++++++++++++++++++++++++++++
 policy/modules/system/systemd.te |  2 ++
 2 files changed, 38 insertions(+)

diff --git a/policy/modules/system/init.if b/policy/modules/system/init.if
index a76eb37e2..d208294ce 100644
--- a/policy/modules/system/init.if
+++ b/policy/modules/system/init.if
@@ -22,6 +22,42 @@ interface(`init_mountpoint',`
 	typeattribute $1 init_mountpoint_type;
 ')
 
+########################################
+## <summary>
+##      Allow connectto initrc_t unix_stream_socket
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Source domain
+##	</summary>
+## </param>
+#
+interface(`init_connectto_stream_socket',`
+	gen_require(`
+		type initrc_t ;
+	')
+
+	allow $1 initrc_t:unix_stream_socket  {connectto};
+')
+
+########################################
+## <summary>
+##      Allow ead write getattr initrc_devpts_t chr_file
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Source domain
+##	</summary>
+## </param>
+#
+interface(`init_read_write_getattr_chr_file',`
+	gen_require(`
+		type initrc_devpts_t;
+	')
+
+	allow $1 initrc_devpts_t:chr_file { read write getattr };
+')
+
 ########################################
 ## <summary>
 ##	Create a file type monitored by a systemd path unit.
diff --git a/policy/modules/system/systemd.te b/policy/modules/system/systemd.te
index 2962e521e..8fe4df664 100644
--- a/policy/modules/system/systemd.te
+++ b/policy/modules/system/systemd.te
@@ -2161,6 +2161,8 @@ chronyd_getattr_init_script_file(systemd_generator_t)
 rpcbind_getattr_init_script_file(systemd_generator_t)
 rpcd_getattr_init_unit_file(systemd_generator_t)
 init_read_generic_units_files(systemd_generator_t)
+init_connectto_stream_socket(systemd_logind_t)
+init_read_write_getattr_chr_file(systemd_passwd_agent_t)
 optional_policy(`
 	dbus_system_bus_client(systemd_user_runtime_dir_t)
 ')
-- 
2.25.1
